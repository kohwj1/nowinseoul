{% extends 'base.html' %}
{% block title %} {{ data.NAME }} :: Now in Seoul{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/detail_page.css') }}">
{% endblock %}

{% block content %}
<div class="top-section">
  <!-- <button class="back-button" onclick="goBack()">
    <img src="{{ url_for('static', filename='images/ui/back-button.png') }}" alt="뒤로가기">
  </button> -->
  <div class="nav p-2 border-bottom">
    <a onclick="goBack()" class="nav-item"><i class="bi bi-chevron-left"></i> Back</a>
    <div class="bi bi-globe me-2" id="lang-select-icon">
        <select id="lang-select" class="opacity-0">
            <option value="en" id="en">EN</option>
            <option value="ja" id="ja">JA</option>
            <option value="ko" id="ko">KO</option>
        </select>
    </div>
</div>
  <img src="{{ url_for('static', filename='images/attraction/' + data.AREA_CD + '.jpg') }}" alt="배경 이미지" class="background-image-cover">
  <div class="header-overlay"></div>
  <div class="hero-text">
    <h1 id="location-name">{{ data.NAME }}</h1>
  </div>
</div>

<div class="page-container">
  <div class="content-section">
    <div class="text-container">
      <p id="location-description">{{ data.DESCRIPTION }}</p>
    </div>
    <button id="read-more-btn">Read more</button>
  </div>

  <section class="info-grid">
    
    <!-- Crowd -->
    <section class="crowd-density-section">
      <div class="surface">
        <div class="info-header">
          {% if data.LIVE_PPLTN_STTS %}
            <div class="info-tag {{ data.LIVE_PPLTN_STTS[0].AREA_CONGEST_LVL.lower().replace(' ','') }}" id="crowd-tag">
              {{ data.LIVE_PPLTN_STTS[0].AREA_CONGEST_LVL }}
            </div>
          {% else %}
            <div class="info-tag">No Data</div>
          {% endif %}
          <div class="info-title">{{ _('crowd-density') }}</div>
        </div>

        {% if data.FCST_PPLTN | length != 0 %}
          <div class="progress-bar-container" id="crowd-density-bar"></div>
          <div class="time-labels">
            <span id="time-now">{{ _('now') }}</span>
          </div>
        {% else %}
          <div class="ps-2 pb-3" id="no-forecast-mgs">No Forecast Data</div>
        {% endif %}
      </div>
    </section>

    <!-- Traffic -->
    <section class="traffic-conditions-section">
      <div class="surface">
        {% if data.ROAD_TRAFFIC_STTS %}
        <div class="info-header">
          <div class="info-tag" id="road-traffic-tag">{{ data.ROAD_TRAFFIC_STTS[0].ROAD_TRAFFIC_IDX or 'No Data' }}</div>
          <div class="info-title">{{ _('traffic-conditions') }}</div>
        </div>
        <div class="ps-2 pb-3" id="traffic-msg"></div>
        {% else %}
        <div class="info-header">
          <div class="info-tag" id="road-traffic-tag">No Data</div>
          <div class="info-title">{{ _('traffic-conditions') }}</div>
        </div>
        <div id="traffic-msg">No Forecast Data</div>
        {% endif %}
      </div>
    </section>

    <!-- Weather -->
    <div class="weather-section">
      <div class="surface">
        <div class="weather-header">
          <div class="left-wrap">
            <h2>{{ _('weather') }}</h2>
            <div class="unit-switch" role="group" aria-label="Temperature unit">
              <button type="button" class="unit-btn active" data-unit="C">℃</button>
              <button type="button" class="unit-btn" data-unit="F">℉</button>
            </div>
          </div>
        </div>

        <div class="weather-forecast-container">
          <div class="weather-forecast">
            {% for item in data.WEATHER_STTS %}
            <div class="forecast-item">
              <span class="time">{{ item.FCST_DT[8:10] }}:00</span>
              <span class="temp">{{ item.TEMP }}<span class="unit">°C</span></span>
              <div class="rain-chance-graph" style="--rain: {{ item.RAIN_CHANCE }}"></div>
              <div class="rain-chance">{{ item.RAIN_CHANCE }}%</div>
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="weather-scroll-controls">
          <div class="scroll-track" role="slider" aria-label="Forecast scroll"
               aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0">
          </div>
        </div>
      </div>
    </div>

    <!-- Bikes -->
    <div class="public-bike-section">
      <div class="surface">
        <div class="bike-header">
          <p id="total-bikes">{{ _('public-bike-available') }}</p>
        </div>
        <div class="bike-map" id="map"></div>
        <ul class="bike-list">
          {% for bike in data.SBIKE_STTS %}
          <li>
            {% if bike.SBIKE_PARKING_CNT == '0' %}
              <span class="bike-count-list bike-zero">{{bike.SBIKE_PARKING_CNT}}</span>
            {% else %}
              <span class="bike-count-list">{{bike.SBIKE_PARKING_CNT}}</span>
            {% endif %}
            <span class="bike-station-name">{{bike.SBIKE_SPOT_NM}}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

  </section>
</div>

<script>
  // const userLocale = navigator.language;
  const pageData  = {{ data | tojson }};
  window.pageData = pageData;
  const crowdData = pageData.FCST_PPLTN;
  const bikeData  = pageData.SBIKE_STTS;
  const weatherData = pageData.WEATHER_STTS;
</script>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/globalLocale.js') }}"></script>
<script src="{{ url_for('static', filename='js/translate.js') }}"></script>
<script src="{{ url_for('static', filename='js/detail_page.js') }}"></script>
<script src="{{ url_for('static', filename='js/bike.js') }}"></script>
<script src="{{ url_for('static', filename='js/crowd_density.js') }}"></script>  
<script src="{{ url_for('static', filename='js/traffic.js') }}"></script>
<script src="{{ url_for('static', filename='js/weather.js') }}"></script>  
{% endblock %}
